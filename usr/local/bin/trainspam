#!/bin/sh -e

# spamc doesn't support learning (bayes) and reporting (pyzor, razor2) in a
# single command, so this wrapper calls it twice to handle both.

if [ "$1" != "ham" -a "$1" != "spam" ]; then
        echo Single argument should be "spam" or "ham"
        exit 1
fi


TMPFILE=`mktemp`
trap 'rm -f $TMPFILE' INT TERM EXIT

cat > "$TMPFILE"

COMMAND="/usr/bin/spamc --socket=/var/run/spamd.socket"

if [ "$1" = "ham" ]; then
        cat "$TMPFILE" | $COMMAND --learntype=ham
        cat "$TMPFILE" | $COMMAND --reporttype=revoke
elif [ "$1" = "spam" ]; then
        cat "$TMPFILE" | $COMMAND --learntype=spam
        cat "$TMPFILE" | $COMMAND --reporttype=report
fi
